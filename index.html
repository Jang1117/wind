<!DOCTYPE html>
<html> 
<head>
  <!-- [Previous head content unchanged except for meta description] -->
  <meta name="description" id="meta-description" content="한국 풍력 발전소의 위치, 제조사, 단지, 사업자, 운영기간 정보를 제공하는 대화형 지도입니다. 신재생에너지와 친환경 에너지 데이터를 확인하세요.">
  <style>
    /* [Previous styles unchanged except for control-button] */
    .control-button {
      width: 120px;
      background: rgba(255, 255, 255, 0.9); /* Slightly more opaque background */
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      text-align: center;
      box-sizing: border-box;
      height: 34px;
      line-height: 34px; /* Align text vertically */
      color: #000; /* Explicit black text color */
      padding: 0 5px; /* Ensure text isn't clipped */
      overflow: visible; /* Prevent text truncation */
      z-index: 10001; /* Ensure buttons are above other elements */
    }
    /* Ensure buttons have proper text color and visibility */
    #initial-reset, #settings-button {
      color: #000; /* Reinforce text color */
      font-weight: 500; /* Slightly bolder for readability */
    }
    /* [Rest of the styles unchanged] */
  </style>
</head>
<body>
  <!-- [Previous HTML unchanged except for controls section] -->
  <div id="controls">
    <button id="initial-btn" class="control-button">처음으로</button>
    <button id="reset-button" class="control-button">선택 초기화</button>
    <select id="windfarm-dropdown" class="control-button">
      <option value="">풍력단지</option>
    </select>
    <select id="manufacturer-dropdown" class="dropdown-button">
      <option value="">제조사</option>
    </select>
    <select id="operator-dropdown" class="control-button">
      <option value="">사업자</option>
    </select>
    <select id="operating-period-dropdown" class="control-button">
      <option value="">운영기간</option>
    </select>
    <button id="settings-btn" class="control-button">설정/Setting</button>
    <div id="settings-container" style="display: none;">
      <!-- [Settings container unchanged] -->
    </div>
  </div>
  <!-- [Rest of HTML unchanged] -->
  
  <script>
    // [Previous JavaScript variables unchanged except adding logging]
    let map;
    let markers = [];
    let overlays = [];
    let currentInfowindows = [];
    let allWindFarms = [];
    let isSatellite = true;
    let turbineCountByComplex = {};
    let totalCapacityByComplex = {};
    let myLocationMarker = null;
    let watchId = null;
    let areNamesVisible = true;
    let areMarkersVisible = true;
    let selectedManufacturer = '';
    let selectedComplex = '';
    let selectedOperator = '';
    let selectedOperatingPeriod = '';
    let isEnglish = false;
    let translations = {};
    let siteTranslations = [];
    let manufacturerData = null;
    const CURRENT_DATE = new Date('2025-06-01');

    // [Translations object unchanged, included for reference]
    translations = {
      "ko": {
        // [Other translations unchanged]
        "initialReset": "처음으로",
        "settings": "설정/Setting",
        // [Rest unchanged]
      },
      "en": {
        // [Other translations unchanged]
        "initialReset": "Home",
        "settings": "Settings/설정",
        // [Rest unchanged]
      }
    };

    // [Other functions unchanged except for updateUILanguage and initializeApp]
    function updateUILanguage() {
      console.log("updateUILanguage called, isEnglish:", isEnglish); // Debug log
      const lang = isEnglish ? 'en' : 'ko';
      document.getElementById('page-title').textContent = translations[lang].title;
      document.getElementById('meta-description').content = translations[lang].title;
      document.getElementById('loading').textContent = translations[lang].loading;
      document.getElementById('map-type-toggle').textContent = isSatellite ? translations[lang].mapTypeToggle : translations[lang].mapTypeToggleSatellite;
      document.getElementById('name-toggle-button').textContent = areNamesVisible ? translations[lang].nameToggle : translations[lang].nameToggleOn;
      document.getElementById('marker-toggle-button').textContent = areMarkersVisible ? translations[lang].markerToggle : translations[lang].markerToggleOn;
      document.getElementById('translate-button').textContent = translations[lang].translate;
      document.getElementById('info-button').textContent = translations[lang].infoButton;
      document.getElementById('reset-button').textContent = translations[lang].reset;
      document.getElementById('initial-btn').textContent = translations[lang].initialReset || "처음으로"; // Fallback text
      document.getElementById('settings-btn').textContent = translations[lang].settings || "설정/Setting"; // Fallback text
      document.getElementById('windfarm-dropdown').options[0].textContent = translations[lang].windfarmDropdown;
      document.getElementById('manufacturer-dropdown').options[0].textContent = translations[lang].manufacturerDropdown;
      document.getElementById('operator-dropdown').options[0].textContent = translations[lang].operatorDropdown;
      document.getElementById('operating-period-dropdown').options[0].textContent = translations[lang].operatingPeriodDropdown;
    
      const windfarmDropdown = document.getElementById('windfarm-dropdown');
      const selectedValue = windfarmDropdown.value;
      while (windfarmDropdown.options.length > 1) windfarmDropdown.remove(1);
      populateDropdown();
      windfarmDropdown.value = selectedValue;
    
      const manufacturerDropdown = document.getElementById('manufacturer-dropdown');
      const selectedManufacturerValue = manufacturerDropdown.value;
      while (manufacturerDropdown.options.length > 1) manufacturerDropdown.remove(1);
      populateManufacturerDropdown();
      manufacturerDropdown.value = selectedManufacturerValue;
    
      const operatorDropdown = document.getElementById('operator-dropdown');
      const selectedOperatorValue = operatorDropdown.value;
      while (operatorDropdown.options.length > 1) operatorDropdown.remove(1);
      populateOperatorDropdown();
      operatorDropdown.value = selectedOperatorValue;
    
      const operatingPeriodDropdown = document.getElementById('operating-period-dropdown');
      const selectedOperatingPeriodValue = operatingPeriodDropdown.value;
      while (operatingPeriodDropdown.options.length > 1) operatingPeriodDropdown.remove(1);
      populateOperatingPeriodDropdown();
      operatingPeriodDropdown.value = selectedOperatingPeriodValue;
    
      updateInfoPanels();
      updateMarkers();
      document.getElementById('info-popup-content').innerHTML = translations[lang].infoPopup;
    }

    async function initializeApp() {
      console.log("앱 초기화 시작");
      await loadTranslations();
      await loadManufacturers();
      await loadCSVData();
      updateUILanguage(); // Ensure called after all data is loaded
      console.log("앱 초기화 완료");
      // Force button text update after DOM is ready
      setTimeout(() => {
        console.log("Forcing button text update");
        document.getElementById('initial-reset').textContent = translations[isEnglish ? 'en' : 'ko'].initialReset || "처음으로";
        document.getElementById('settings-button').textContent = translations[isEnglish ? 'en' : 'ko'].settings || "설정/Setting";
      }, 100);
    }

    // [Rest of JavaScript unchanged: loadManufacturers, loadTranslations, getTranslatedSiteInfo, calculateOperatingPeriod, getOperatingPeriodRange, resetToInitial, resetSelectionsOnly, showError, toggleLanguage, toggleInfoPopup, formatNumberWithCommas, formatGW, loadCSVData, initMap, toggleMapType, toggleNamesVisibility, toggleMarkersVisibility, populateDropdown, populateManufacturerDropdown, populateOperatorDropdown, populateOperatingPeriodDropdown, handleDropdownChange, handleManufacturerChange, handleOperatorChange, handleOperatingPeriodChange, updateComplexInfo, updateInfoPanels, startTrackingLocation, updateMyLocation, clearMap, updateMarkers, toggleFarmDetails, closeInfowindow]

    document.addEventListener('DOMContentLoaded', function() {
      kakao.maps.load(() => {
        console.log("Kakao Maps API 로드 성공");
        initializeApp();
      });
    });

    window.addEventListener('unload', () => {
      if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        console.log("위치 추적 중지");
      }
    });
  </script>
</body>
</html>
